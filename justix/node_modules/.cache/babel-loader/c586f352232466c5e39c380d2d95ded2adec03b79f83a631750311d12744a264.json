{"ast":null,"code":"import React,{useState,useEffect}from'react';import axios from'axios';import{useNavigate}from'react-router-dom';import styles from'../../../pages/Login/Login.module.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const PortaisForm=_ref=>{let{id_portal,onCommentAdded}=_ref;const[newComment,setNewComment]=useState('');const[rating,setRating]=useState(1);const[arrivalTime,setArrivalTime]=useState('');const[departureTime,setDepartureTime]=useState('');const[user,setUser]=useState(null);const[error,setError]=useState('');const navigate=useNavigate();useEffect(()=>{const storedUser=JSON.parse(localStorage.getItem('usuarios'));if(storedUser){setUser(storedUser);}},[]);const updateUserProgress=userId=>{const currentProgress=parseInt(localStorage.getItem(`userProgress_${userId}`))||0;const newProgress=Math.min(currentProgress+50,1000);// Adiciona 50 pontos por submissão, max 1000\nlocalStorage.setItem(`userProgress_${userId}`,newProgress.toString());};const handleSubmitComment=async e=>{e.preventDefault();setError('');if(!user){setError('Usuário não identificado. Por favor, faça login novamente.');return;}if(!id_portal){setError('ID do portal não identificado.');return;}const formData={id_usuario:parseInt(user.id,10),id_portal:parseInt(id_portal,10),comentario:newComment,avaliacao:rating,// Avaliação em estrelas\nhorario_chegada:arrivalTime||null,horario_saida:departureTime||null};try{const response=await axios.post('http://localhost:3001/av_portal',formData);// Atualiza progresso após envio bem-sucedido\nupdateUserProgress(user.id);setNewComment('');setRating(1);setArrivalTime('');setDepartureTime('');setError('');if(onCommentAdded)onCommentAdded();navigate(-1);// Redireciona para a página anterior\n}catch(error){var _error$response,_error$response$data;console.error('Erro completo:',error);const errorMessage=((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||'Erro ao adicionar comentário';setError(errorMessage);}};const handleStarClick=star=>{setRating(star);};return/*#__PURE__*/_jsx(\"section\",{className:styles.loginSection,children:/*#__PURE__*/_jsxs(\"div\",{className:styles.loginContainer,children:[/*#__PURE__*/_jsx(\"h4\",{className:styles.title,children:\"Deixe seu Feedback\"}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmitComment,className:styles.loginForm,children:[/*#__PURE__*/_jsxs(\"div\",{className:styles.formGroupD,children:[/*#__PURE__*/_jsx(\"label\",{children:\"Hor\\xE1rio de Chegada (Opcional):\"}),/*#__PURE__*/_jsx(\"input\",{type:\"time\",value:arrivalTime,onChange:e=>setArrivalTime(e.target.value),className:styles.formcontrol})]}),/*#__PURE__*/_jsxs(\"div\",{className:styles.formGroupD,children:[/*#__PURE__*/_jsx(\"label\",{children:\"Hor\\xE1rio de Sa\\xEDda (Opcional):\"}),/*#__PURE__*/_jsx(\"input\",{type:\"time\",value:departureTime,onChange:e=>setDepartureTime(e.target.value),className:styles.formcontrol})]}),/*#__PURE__*/_jsxs(\"div\",{className:styles.formGroupC,children:[/*#__PURE__*/_jsx(\"label\",{children:\"Coment\\xE1rio:\"}),/*#__PURE__*/_jsx(\"textarea\",{value:newComment,onChange:e=>setNewComment(e.target.value),className:styles.formcontrol})]}),/*#__PURE__*/_jsxs(\"div\",{className:styles.formgroup,children:[/*#__PURE__*/_jsx(\"label\",{children:\"Deixe sua avalia\\xE7\\xE3o:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"star-rating\",children:[1,2,3,4,5].map(star=>/*#__PURE__*/_jsx(\"span\",{className:styles.star,onClick:()=>handleStarClick(star),style:{cursor:'pointer',color:star<=rating?'black':'white',fontSize:'3em'},children:\"\\u2605\"},star))})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:styles.submitButton,children:\"Enviar Coment\\xE1rio\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>navigate(-1),className:styles.submitButton,children:\"Cancelar\"})]})]})]})});};export default PortaisForm;","map":{"version":3,"names":["React","useState","useEffect","axios","useNavigate","styles","jsx","_jsx","jsxs","_jsxs","PortaisForm","_ref","id_portal","onCommentAdded","newComment","setNewComment","rating","setRating","arrivalTime","setArrivalTime","departureTime","setDepartureTime","user","setUser","error","setError","navigate","storedUser","JSON","parse","localStorage","getItem","updateUserProgress","userId","currentProgress","parseInt","newProgress","Math","min","setItem","toString","handleSubmitComment","e","preventDefault","formData","id_usuario","id","comentario","avaliacao","horario_chegada","horario_saida","response","post","_error$response","_error$response$data","console","errorMessage","data","handleStarClick","star","className","loginSection","children","loginContainer","title","onSubmit","loginForm","formGroupD","type","value","onChange","target","formcontrol","formGroupC","formgroup","map","onClick","style","cursor","color","fontSize","submitButton"],"sources":["C:/Users/vinic/OneDrive/Área de Trabalho/React project/justix/src/components/BDPages/Feedbacks/PortaisFormFeed.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport styles from '../../../pages/Login/Login.module.css';\r\n\r\nconst PortaisForm = ({ id_portal, onCommentAdded }) => {\r\n    const [newComment, setNewComment] = useState('');\r\n    const [rating, setRating] = useState(1);\r\n    const [arrivalTime, setArrivalTime] = useState('');\r\n    const [departureTime, setDepartureTime] = useState('');\r\n    const [user, setUser] = useState(null);\r\n    const [error, setError] = useState('');\r\n    const navigate = useNavigate();\r\n\r\n    useEffect(() => {\r\n        const storedUser = JSON.parse(localStorage.getItem('usuarios'));\r\n        if (storedUser) {\r\n            setUser(storedUser);\r\n        }\r\n    }, []);\r\n\r\n    const updateUserProgress = (userId) => {\r\n        const currentProgress = parseInt(localStorage.getItem(`userProgress_${userId}`)) || 0;\r\n        const newProgress = Math.min(currentProgress + 50, 1000); // Adiciona 50 pontos por submissão, max 1000\r\n        localStorage.setItem(`userProgress_${userId}`, newProgress.toString());\r\n    };\r\n\r\n    const handleSubmitComment = async (e) => {\r\n        e.preventDefault();\r\n        setError('');\r\n\r\n        if (!user) {\r\n            setError('Usuário não identificado. Por favor, faça login novamente.');\r\n            return;\r\n        }\r\n\r\n        if (!id_portal) {\r\n            setError('ID do portal não identificado.');\r\n            return;\r\n        }\r\n\r\n        const formData = {\r\n            id_usuario: parseInt(user.id, 10),\r\n            id_portal: parseInt(id_portal, 10),\r\n            comentario: newComment,\r\n            avaliacao: rating,  // Avaliação em estrelas\r\n            horario_chegada: arrivalTime || null,\r\n            horario_saida: departureTime || null,\r\n        };\r\n\r\n        try {\r\n            const response = await axios.post('http://localhost:3001/av_portal', formData);\r\n            \r\n            // Atualiza progresso após envio bem-sucedido\r\n            updateUserProgress(user.id);\r\n            \r\n            setNewComment('');\r\n            setRating(1);\r\n            setArrivalTime('');\r\n            setDepartureTime('');\r\n            setError('');\r\n\r\n            if (onCommentAdded) onCommentAdded();\r\n            navigate(-1); // Redireciona para a página anterior\r\n        } catch (error) {\r\n            console.error('Erro completo:', error);\r\n            const errorMessage = error.response?.data?.error || 'Erro ao adicionar comentário';\r\n            setError(errorMessage);\r\n        }\r\n    };\r\n\r\n    const handleStarClick = (star) => {\r\n        setRating(star);\r\n    };\r\n\r\n    return (\r\n        <section className={styles.loginSection}>\r\n        <div className={styles.loginContainer}>\r\n            <h4 className={styles.title}>Deixe seu Feedback</h4>\r\n            {error && <div className=\"error-message\">{error}</div>}\r\n            <form onSubmit={handleSubmitComment} className={styles.loginForm}>\r\n                <div className={styles.formGroupD}>\r\n                    <label>Horário de Chegada (Opcional):</label>\r\n                    <input\r\n                        type=\"time\"\r\n                        value={arrivalTime}\r\n                        onChange={(e) => setArrivalTime(e.target.value)}\r\n                        className={styles.formcontrol}\r\n                    />\r\n                </div>\r\n                <div className={styles.formGroupD}>\r\n                    <label>Horário de Saída (Opcional):</label>\r\n                    <input\r\n                        type=\"time\"\r\n                        value={departureTime}\r\n                        onChange={(e) => setDepartureTime(e.target.value)}\r\n                        className={styles.formcontrol}\r\n                    />\r\n                </div>\r\n                <div className={styles.formGroupC}>\r\n                    <label>Comentário:</label>\r\n                    <textarea\r\n                        value={newComment}\r\n                        onChange={(e) => setNewComment(e.target.value)}\r\n                        className={styles.formcontrol}\r\n                    />\r\n                </div>\r\n                <div className={styles.formgroup}>\r\n                    <label>Deixe sua avaliação:</label>\r\n                    <div className=\"star-rating\">\r\n                        {[1, 2, 3, 4, 5].map((star) => (\r\n                            <span\r\n                            className={styles.star}\r\n                                key={star}\r\n                                onClick={() => handleStarClick(star)}\r\n                                style={{\r\n                                    cursor: 'pointer',\r\n                                    color: star <= rating ? 'black' : 'white',\r\n                                    fontSize: '3em'\r\n                                }}\r\n                            >\r\n                                ★\r\n                            </span>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n                <div>\r\n                <button type=\"submit\" className={styles.submitButton}>\r\n                    Enviar Comentário\r\n                </button>\r\n                <button type=\"button\" onClick={() => navigate(-1)} className={styles.submitButton}>\r\n                    Cancelar\r\n                </button>\r\n                </div>\r\n            </form>\r\n        </div>\r\n        </section>\r\n    );\r\n};\r\n\r\nexport default PortaisForm;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}