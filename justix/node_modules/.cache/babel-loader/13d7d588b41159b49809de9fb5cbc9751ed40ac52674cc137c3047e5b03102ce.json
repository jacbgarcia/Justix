{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate,useLocation}from'react-router-dom';import axios from'axios';import styles from'../../pages/Login/Login.module.css';import ContainerHome from'../ContainerHome';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const PortaisFormPageO=()=>{var _location$state;const navigate=useNavigate();const location=useLocation();const portaisAtivo=((_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.portais)||null;const[formData,setFormData]=useState({nome:'',url:'',avaliacao_media:2.00// valor padrão conforme backend\n});const[imagemFile,setImagemFile]=useState(null);const[previewUrl,setPreviewUrl]=useState(null);const[error,setError]=useState(null);useEffect(()=>{if(portaisAtivo){setFormData({nome:portaisAtivo.nome||'',url:portaisAtivo.url||'',avaliacao_media:portaisAtivo.avaliacao_media||2.00});// Corrigindo a URL do preview\nif(portaisAtivo.imagem){// Remove o /uploads/ duplicado se necessário\nconst imagemPath=portaisAtivo.imagem.startsWith('/uploads/')?portaisAtivo.imagem:`/uploads/${portaisAtivo.imagem}`;setPreviewUrl(`http://localhost:3001${imagemPath}`);}}},[portaisAtivo]);const handleImagemChange=e=>{const file=e.target.files[0];if(file){if(file.size>5*1024*1024){// 5MB limit\nsetError('Arquivo muito grande. Máximo 5MB.');return;}setImagemFile(file);const fileUrl=URL.createObjectURL(file);setPreviewUrl(fileUrl);setError(null);}};const handleSubmit=async e=>{e.preventDefault();try{setError(null);const submitFormData=new FormData();// Validação da URL\ntry{new URL(formData.url);}catch(e){setError('URL inválida. Inclua http:// ou https://');return;}// Adiciona os campos ao FormData\nsubmitFormData.append('nome',formData.nome);submitFormData.append('url',formData.url);submitFormData.append('avaliacao_media',formData.avaliacao_media);// Adiciona a imagem apenas se uma nova imagem foi selecionada\nif(imagemFile){submitFormData.append('imagem',imagemFile);}if(portaisAtivo){// Corrigindo o nome do parâmetro ID\nconst response=await axios.put(`http://localhost:3001/portais/${portaisAtivo.id_portal||portaisAtivo.id_portais}`,submitFormData,{headers:{'Content-Type':'multipart/form-data'}});console.log('Resposta da atualização:',response.data);}else{const response=await axios.post('http://localhost:3001/portais',submitFormData,{headers:{'Content-Type':'multipart/form-data'}});console.log('Resposta da criação:',response.data);}navigate('/admin/dashboard/portais');}catch(err){var _err$response,_err$response$data;console.error('Erro ao salvar portal:',err);setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.error)||'Erro ao salvar o portal');}};const handleCancel=()=>{navigate('/admin/dashboard/portais');};return/*#__PURE__*/_jsx(ContainerHome,{children:/*#__PURE__*/_jsx(\"section\",{className:styles.loginSection,children:/*#__PURE__*/_jsxs(\"div\",{className:styles.loginContainer,children:[/*#__PURE__*/_jsx(\"h3\",{className:styles.title,children:portaisAtivo?'Editar Portal':'Novo Portal'}),error&&/*#__PURE__*/_jsx(\"div\",{className:styles.error,children:error}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:styles.loginForm,children:[/*#__PURE__*/_jsxs(\"div\",{className:styles.formGroup,children:[/*#__PURE__*/_jsx(\"label\",{children:\"Nome:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:formData.nome,onChange:e=>setFormData({...formData,nome:e.target.value}),required:true,minLength:3,maxLength:255})]}),/*#__PURE__*/_jsxs(\"div\",{className:styles.formGroup,children:[/*#__PURE__*/_jsx(\"label\",{children:\"URL:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"url\",value:formData.url,onChange:e=>setFormData({...formData,url:e.target.value}),required:true,placeholder:\"https://exemplo.com\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:styles.formGroup,children:[/*#__PURE__*/_jsx(\"label\",{children:\"Foto:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:handleImagemChange}),previewUrl&&/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"img\",{src:previewUrl,alt:\"Preview\",style:{maxWidth:'200px',marginTop:'10px'}})})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:styles.submitButton,children:portaisAtivo?'Salvar Alterações':'Criar Portal'}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleCancel,className:styles.submitButton,children:\"Cancelar\"})]})]})})});};export default PortaisFormPageO;","map":{"version":3,"names":["React","useState","useEffect","useNavigate","useLocation","axios","styles","ContainerHome","jsx","_jsx","jsxs","_jsxs","PortaisFormPageO","_location$state","navigate","location","portaisAtivo","state","portais","formData","setFormData","nome","url","avaliacao_media","imagemFile","setImagemFile","previewUrl","setPreviewUrl","error","setError","imagem","imagemPath","startsWith","handleImagemChange","e","file","target","files","size","fileUrl","URL","createObjectURL","handleSubmit","preventDefault","submitFormData","FormData","append","response","put","id_portal","id_portais","headers","console","log","data","post","err","_err$response","_err$response$data","handleCancel","children","className","loginSection","loginContainer","title","onSubmit","loginForm","formGroup","type","value","onChange","required","minLength","maxLength","placeholder","accept","src","alt","style","maxWidth","marginTop","submitButton","onClick"],"sources":["C:/Users/vinic/OneDrive/Área de Trabalho/React project/justix/src/components/BD/PortaisFormPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport styles from '../../pages/Login/Login.module.css';\r\nimport ContainerHome from '../ContainerHome';\r\n\r\nconst PortaisFormPageO = () => {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const portaisAtivo = location.state?.portais || null;\r\n\r\n  const [formData, setFormData] = useState({\r\n    nome: '',\r\n    url: '',\r\n    avaliacao_media: 2.00 // valor padrão conforme backend\r\n  });\r\n\r\n  const [imagemFile, setImagemFile] = useState(null);\r\n  const [previewUrl, setPreviewUrl] = useState(null);\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    if (portaisAtivo) {\r\n      setFormData({\r\n        nome: portaisAtivo.nome || '',\r\n        url: portaisAtivo.url || '',\r\n        avaliacao_media: portaisAtivo.avaliacao_media || 2.00\r\n      });\r\n      \r\n      // Corrigindo a URL do preview\r\n      if (portaisAtivo.imagem) {\r\n        // Remove o /uploads/ duplicado se necessário\r\n        const imagemPath = portaisAtivo.imagem.startsWith('/uploads/') \r\n          ? portaisAtivo.imagem \r\n          : `/uploads/${portaisAtivo.imagem}`;\r\n        setPreviewUrl(`http://localhost:3001${imagemPath}`);\r\n      }\r\n    }\r\n  }, [portaisAtivo]);\r\n\r\n  const handleImagemChange = (e) => {\r\n    const file = e.target.files[0];\r\n    if (file) {\r\n      if (file.size > 5 * 1024 * 1024) { // 5MB limit\r\n        setError('Arquivo muito grande. Máximo 5MB.');\r\n        return;\r\n      }\r\n      setImagemFile(file);\r\n      const fileUrl = URL.createObjectURL(file);\r\n      setPreviewUrl(fileUrl);\r\n      setError(null);\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    try {\r\n      setError(null);\r\n      const submitFormData = new FormData();\r\n      \r\n      // Validação da URL\r\n      try {\r\n        new URL(formData.url);\r\n      } catch (e) {\r\n        setError('URL inválida. Inclua http:// ou https://');\r\n        return;\r\n      }\r\n\r\n      // Adiciona os campos ao FormData\r\n      submitFormData.append('nome', formData.nome);\r\n      submitFormData.append('url', formData.url);\r\n      submitFormData.append('avaliacao_media', formData.avaliacao_media);\r\n\r\n      // Adiciona a imagem apenas se uma nova imagem foi selecionada\r\n      if (imagemFile) {\r\n        submitFormData.append('imagem', imagemFile);\r\n      }\r\n\r\n      if (portaisAtivo) {\r\n        // Corrigindo o nome do parâmetro ID\r\n        const response = await axios.put(\r\n          `http://localhost:3001/portais/${portaisAtivo.id_portal || portaisAtivo.id_portais}`,\r\n          submitFormData,\r\n          {\r\n            headers: {\r\n              'Content-Type': 'multipart/form-data'\r\n            }\r\n          }\r\n        );\r\n        console.log('Resposta da atualização:', response.data);\r\n      } else {\r\n        const response = await axios.post(\r\n          'http://localhost:3001/portais',\r\n          submitFormData,\r\n          {\r\n            headers: {\r\n              'Content-Type': 'multipart/form-data'\r\n            }\r\n          }\r\n        );\r\n        console.log('Resposta da criação:', response.data);\r\n      }\r\n      navigate('/admin/dashboard/portais');\r\n    } catch (err) {\r\n      console.error('Erro ao salvar portal:', err);\r\n      setError(err.response?.data?.error || 'Erro ao salvar o portal');\r\n    }\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    navigate('/admin/dashboard/portais');\r\n  };\r\n\r\n  return (\r\n    <ContainerHome>\r\n      <section className={styles.loginSection}>\r\n        <div className={styles.loginContainer}>\r\n          <h3 className={styles.title}>{portaisAtivo ? 'Editar Portal' : 'Novo Portal'}</h3>\r\n          {error && (\r\n            <div className={styles.error}>\r\n              {error}\r\n            </div>\r\n          )}\r\n          <form onSubmit={handleSubmit} className={styles.loginForm}>\r\n            <div className={styles.formGroup}>\r\n              <label>Nome:</label>\r\n              <input\r\n                type=\"text\"\r\n                value={formData.nome}\r\n                onChange={(e) => setFormData({ ...formData, nome: e.target.value })}\r\n                required\r\n                minLength={3}\r\n                maxLength={255}\r\n              />\r\n            </div>\r\n            <div className={styles.formGroup}>\r\n              <label>URL:</label>\r\n              <input\r\n                type=\"url\"\r\n                value={formData.url}\r\n                onChange={(e) => setFormData({ ...formData, url: e.target.value })}\r\n                required\r\n                placeholder=\"https://exemplo.com\"\r\n              />\r\n            </div>\r\n            <div className={styles.formGroup}>\r\n              <label>Foto:</label>\r\n              <input\r\n                type=\"file\"\r\n                accept=\"image/*\"\r\n                onChange={handleImagemChange}\r\n              />\r\n              {previewUrl && (\r\n                <div>\r\n                  <img \r\n                    src={previewUrl} \r\n                    alt=\"Preview\" \r\n                    style={{ maxWidth: '200px', marginTop: '10px' }}\r\n                  />\r\n                </div>\r\n              )}\r\n            </div>\r\n            <button type=\"submit\" className={styles.submitButton}>\r\n              {portaisAtivo ? 'Salvar Alterações' : 'Criar Portal'}\r\n            </button>\r\n            <button type=\"button\" onClick={handleCancel} className={styles.submitButton}>\r\n              Cancelar\r\n            </button>\r\n          </form>\r\n        </div>\r\n      </section>\r\n    </ContainerHome>\r\n  );\r\n};\r\n\r\nexport default PortaisFormPageO;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}